
<!------ Include the above in your HEAD tag ---------->

<!DOCTYPE html>
<html>
    <head>
        <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
        <link rel="stylesheet" href="/static/style.css">

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">

        <!-- jQuery library -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

        <!-- Popper JS -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>

        <!-- Latest compiled JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>

        <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
        <script src="//code.jquery.com/jquery-1.11.1.min.js"></script>
        <!-- <script src="/static/script.js"></script> -->

        <title>*** Tchat ***</title>
    </head>
    <body>
        <div id="app">
            <h1>TCHAT User: {{request.user}}</h1>
            <div style="width: 1200px; height: 700px;" class="col-sm-3 col-sm-offset-4 frame">
                <ul>
                    <li v-for='item in reponse'>
                        ${item.user} : ${item.mes}
                    </li>
                </ul>
                <div>
                    <div class="msj-rta macro">                        
                        <div class="text text-r" style="background:rgb(24, 2, 22) !important">
                            <input v-model="message" class="mytext" placeholder="Type a message"/>
                        </div> 

                    </div>
                    <div style="padding:10px;">
                        <button @click="sendmessage" type="button" class="btn btn-primary">Send</button>
                    </div>                
                </div>
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.17/vue.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/reconnecting-websocket@4.1.10/dist/reconnecting-websocket-cjs.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/vue-websocket@0.2.3/dist/vue-websocket.min.js"></script>
        <script>
            const app = new Vue({
                el: "#app",
                data: {
                    message: "",
                    reponse: [],
                    username:"{{request.user}}",
                },
                delimiters: ["${", "}"],
                mounted: function() {
                    this.connect()
                },
                methods: {
                
                    connect() {
                        roomName = "hello"
                        this.socket = new WebSocket('ws://127.0.0.1:8000/ws/chat/' + roomName + '/');
                        this.socket.onopen = () => {
                            this.status = "connected";
                            console.log("connecte")
                            
                            this.socket.onmessage = ({data}) => {
                                
                            //Recuperation message 
                            wsdata = JSON.parse(data)
                            console.log(wsdata.message.mes)
                            this.reponse.push(wsdata.message)    
                            console.log(this.reponse)     
                                
                            };
                        };
                    },
                    disconnect() {
                        this.socket.close();
                        
                        console.log("deconnecte")
                    },
                    
                    
                    sendmessage: function(){
                        data = {
                            'message':{ 
                                'mes':this.message,
                                'user':this.username 
                            }
                        }
                        this.socket.send(JSON.stringify(data));
                    },
                    updateAdmin: function(){
                        
                        this.socket.send(JSON.stringify({ 'message':"code send succes", 'admin':this.admin, 'code':this.codedep }));

                    },
                    
                            
                }
    });
        </script>
    </body>
</html>
